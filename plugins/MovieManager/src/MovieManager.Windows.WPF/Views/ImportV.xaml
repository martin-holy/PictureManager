<ResourceDictionary
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:vm="clr-namespace:MovieManager.Common.ViewModels;assembly=MovieManager.Common"
  xmlns:mhu="clr-namespace:MH.UI.WPF.Utils;assembly=MH.UI.WPF">
    
  <DataTemplate DataType="{x:Type vm:ImportVM}">
    <DataTemplate.Resources>
      <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
          <mhu:CachedResourceDictionary Source="MovieSearchResultV.xaml"/>
        </ResourceDictionary.MergedDictionaries>

        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
          <Setter Property="MinHeight" Value="30"/>
          <Setter Property="MinWidth" Value="60"/>
          <Setter Property="Margin" Value="5"/>
        </Style>
      </ResourceDictionary>
    </DataTemplate.Resources>

    <Grid HorizontalAlignment="Left">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="350"/>
        <ColumnDefinition Width="350"/>
      </Grid.ColumnDefinitions>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <TextBlock
        Text="Search query:"
        Grid.Column="0"
        Grid.Row="0"
        Margin="5,0,0,2"/>

      <TextBox
        x:Name="search"
        Grid.Column="0"
        Grid.Row="1"
        VerticalContentAlignment="Top"
        TextWrapping="NoWrap"
        FontSize="14"
        AcceptsReturn="True"
        MinLines="7"
        Margin="2"
        Padding="2"/>

      <StackPanel
        Grid.Column="0"
        Grid.Row="2"
        Orientation="Horizontal"
        HorizontalAlignment="Right">

        <Button
          Content="Search"
          Command="{Binding SearchCommand}"
          CommandParameter="{Binding Text, ElementName=search}"/>

        <Button
          Content="Import"
          Command="{Binding ImportCommand}"
          CommandParameter="{Binding Path=SelectedItem, ElementName=result}"/>

        <Button
          Content="Cancel"
          Command="{Binding CancelCommand}"/>
      </StackPanel>

      <TextBlock
        Text="Search results:"
        Grid.Column="0"
        Grid.Row="3"
        Margin="5,0,0,2"/>

      <ListBox
        x:Name="result"
        Grid.Column="0"
        Grid.Row="4"
        Margin="2"
        ItemsSource="{Binding SearchResults}"
        ItemTemplate="{StaticResource MM.DT.SearchResult}"/>

      <TextBlock
        Text="Log:"
        Grid.Column="1"
        Grid.Row="0"
        Margin="5,0,0,2"/>

      <ListBox
        Grid.Column="1"
        Grid.Row="1"
        Grid.RowSpan="4"
        Margin="2"
        ItemsSource="{Binding ProgressCollection}">

        <ListBox.ItemTemplate>
          <DataTemplate>
            <TextBlock Text="{Binding}"/>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </Grid>
  </DataTemplate>
</ResourceDictionary>