<UserControl x:Class="PictureManager.UserControls.TreeViewCategories"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:pm="clr-namespace:PictureManager"
             xmlns:cc="clr-namespace:PictureManager.CustomControls"
             xmlns:uc="clr-namespace:PictureManager.UserControls"
             xmlns:cmd="clr-namespace:PictureManager.Commands"
             xmlns:models="clr-namespace:PictureManager.Domain.Models;assembly=PictureManager.Domain"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:mhc="clr-namespace:MH.UI.WPF.Controls;assembly=MH.UI.WPF">
  <Grid>
    <Grid.Resources>
      <!-- CategoriesBarButtonStyle -->
      <Style x:Key="CategoriesNavBarButtonStyle" TargetType="Button" BasedOn="{StaticResource StyleButtonIcon}">
        <Setter Property="Width" Value="32" />
        <Setter Property="Height" Value="32" />
        <Setter Property="ToolTip" Value="{Binding Title}" />
      </Style>

      <!-- SearchButtonStyle -->
      <Style x:Key="SearchButtonStyle" TargetType="Button" BasedOn="{StaticResource CategoriesNavBarButtonStyle}">
        <Setter Property="ToolTip" Value="Search" />
      </Style>
    </Grid.Resources>

    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <Border Grid.Row="0" BorderThickness="0,0,0,4" BorderBrush="{StaticResource AccentColorBrush4}">
      <DockPanel Height="34">
        <!-- TreeView Categories Navigation Bar -->
        <ItemsControl ItemsSource="{Binding TreeViewCategories, Source={x:Static pm:App.Core}}" DockPanel.Dock="Left">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>

          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <mhc:IconButton Size="22" ToolTip="{Binding Title}" Click="BtnNavCategory_OnClick" ShowShadow="False"
                              Fill="{Binding IconName, Converter={StaticResource IconNameToBrushConverter}}"
                              Source="{Binding IconName, Converter={StaticResource IconNameToStaticResourceConverter}}" />
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
          <!-- Search -->
          <mhc:IconButton Size="22" Source="{StaticResource IconMagnify}" Click="ShowSearch" ShowShadow="False" />

          <!-- Button to pin slide panel -->
          <mhc:IconToggleButton x:Name="BtnPinPanel" Command="{x:Static cmd:WindowCommands.ShowHideTabMainCommand}"
                                Source="{StaticResource IconPin}" Size="14" IsThreeState="False" ShowShadow="False"
                                IsChecked="{Binding SlidePanelMainTreeView.IsPinned, Source={x:Static pm:App.WMain}}"/>
        </StackPanel>
      </DockPanel>
    </Border>

    <!-- CatTreeView Categories -->
    <cc:CatTreeView x:Name="TvCategories" Grid.Row="1" FocusManager.IsFocusScope="True"
                    ItemsSource="{Binding TreeViewCategories, Source={x:Static pm:App.Core}}">

      <!-- BlurEffect when Search is visible -->
      <cc:CatTreeView.Style>
        <Style TargetType="{x:Type cc:CatTreeView}" BasedOn="{StaticResource CatTreeView}">
          <Style.Triggers>
            <DataTrigger Binding="{Binding Visibility, ElementName=Search}" Value="Visible">
              <Setter Property="Effect">
                <Setter.Value>
                  <BlurEffect Radius="4" KernelType="Gaussian" />
                </Setter.Value>
              </Setter>
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </cc:CatTreeView.Style>

      <cc:CatTreeView.Resources>
        <!-- DataTemplate - Rating -->
        <HierarchicalDataTemplate DataType="{x:Type models:Rating}">
          <StackPanel Orientation="Horizontal">
            <StackPanel Orientation="Horizontal">
              <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=0}" />
              <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=1}" />
              <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=2}" />
              <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=3}" />
              <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=4}" />
            </StackPanel>
            <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
          </StackPanel>
        </HierarchicalDataTemplate>

        <!-- DataTemplate - MediaItemSize -->
        <HierarchicalDataTemplate DataType="{x:Type models:MediaItemSize}">
          <StackPanel Orientation="Horizontal" Margin="0,0,3,3">
            <Grid Width="{Binding ActualWidth, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type StackPanel}}}">
              <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition />
              </Grid.RowDefinitions>
              <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
              </Grid.ColumnDefinitions>

              <TextBlock HorizontalAlignment="Left" Grid.Row="0" Grid.Column="0" 
                         Text="{Binding PixelMin, Converter={StaticResource MediaItemSizeConverter}}" />
              <TextBlock HorizontalAlignment="Right" Grid.Row="0" Grid.Column="1" 
                         Text="{Binding PixelMax, Converter={StaticResource MediaItemSizeConverter}}" />

              <mah:RangeSlider Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Stretch" 
                               MoveWholeRange="True" IsSnapToTickEnabled="True" TickFrequency="0.1"
                               Minimum="{Binding Min}" Maximum="{Binding Max}"
                               LowerValue="{Binding PixelMin}" UpperValue="{Binding PixelMax}" 
                               UpperThumbDragCompleted="MediaItemSize_OnDragCompleted"
                               LowerThumbDragCompleted="MediaItemSize_OnDragCompleted"
                               CentralThumbDragCompleted="MediaItemSize_OnDragCompleted"/>
            </Grid>
          </StackPanel>
        </HierarchicalDataTemplate>
      </cc:CatTreeView.Resources>

      <cc:CatTreeView.ItemContainerStyle>
        <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource CatTreeViewItem}">
          <Setter Property="VerticalContentAlignment" Value="Stretch" />
          <Setter Property="HorizontalContentAlignment" Value="Stretch" />
          <Setter Property="Background" Value="{Binding BackgroundBrush, Converter={StaticResource BgColorConverter}}" />
          <EventSetter Event="MouseLeftButtonUp" Handler="TreeView_Select" />
          <EventSetter Event="PreviewMouseRightButtonDown" Handler="AttachContextMenu" />
          <EventSetter Event="ToolTipOpening" Handler="ItemToolTip_ToolTipOpening" />
          
          <Style.Triggers>
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding IsMarked}" Value="True" />
                <Condition Binding="{Binding BackgroundBrush}" Value="0" />
              </MultiDataTrigger.Conditions>
              <Setter Property="Background" Value="{DynamicResource AccentColorBrush4}" />
            </MultiDataTrigger>

            <!-- this is for Folder -->
            <DataTrigger Binding="{Binding IsHidden}" Value="True">
              <Setter Property="Visibility" Value="Collapsed" />
            </DataTrigger>

            <DataTrigger Binding="{Binding ToolTip, Converter={StaticResource AllToBoolConverter}}" Value="True">
              <Setter Property="ToolTip" Value="{Binding ToolTip}" />
            </DataTrigger>
            
            <!-- Persons Segment -->
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding Converter={StaticResource DataTypeConverter}}" Value="{x:Type models:Person}" />
                <Condition Binding="{Binding Segment, Converter={StaticResource AllToBoolConverter}}" Value="True" />
              </MultiDataTrigger.Conditions>
              <Setter Property="ToolTip">
                <Setter.Value>
                  <ToolTip BorderThickness="0" Padding="0">
                    <Border BorderThickness="1" BorderBrush="Black">
                      <Image Source="{Binding Segment.Picture}" Width="{Binding Segments.SegmentSize, Source={x:Static pm:App.Core}}" />
                    </Border>
                  </ToolTip>
                </Setter.Value>
              </Setter>
            </MultiDataTrigger>

          </Style.Triggers>
        </Style>
      </cc:CatTreeView.ItemContainerStyle>
    </cc:CatTreeView>

    <!-- Search -->
    <uc:TreeViewSearch Grid.Row="1" x:Name="Search" Visibility="Collapsed" />

  </Grid>
</UserControl>
