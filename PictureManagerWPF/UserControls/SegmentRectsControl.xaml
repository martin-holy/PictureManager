<UserControl x:Class="PictureManager.UserControls.SegmentRectsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:uc="clr-namespace:PictureManager.UserControls"
             xmlns:mhc="clr-namespace:MH.UI.WPF.Controls;assembly=MH.UI.WPF">
  
  <UserControl.Resources>
    <!-- SegmentRect DataTemplate -->
    <DataTemplate x:Key="_segmentRect" DataType="{x:Type uc:SegmentRect}">
      <Border MinWidth="{Binding Size}" MinHeight="{Binding Size}" Background="Transparent"
              ToolTipService.InitialShowDelay="0"
              Effect="{StaticResource Res_ShadowEffect}"
              HorizontalAlignment="Left" VerticalAlignment="Top"
              PreviewMouseDown="SegmentRect_PreviewMouseDown">
        
        <Border.Style>
          <Style TargetType="{x:Type Border}">
            <Setter Property="RenderTransform">
              <Setter.Value>
                <TranslateTransform X="{Binding X}" Y="{Binding Y}" />
              </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="White" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="ToolTip" Value="{Binding Segment.Person.Name}" />
            <Style.Triggers>
              <DataTrigger Binding="{Binding Segment.IsSelected}" Value="True">
                <Setter Property="BorderBrush" Value="LimeGreen" />
              </DataTrigger>
              <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True">
                <Setter Property="BorderThickness" Value="2" />
              </DataTrigger>
              <DataTrigger Binding="{Binding Segment.Person}" Value="{x:Null}">
                <Setter Property="ToolTip" Value="{Binding Segment.PersonId}" />
              </DataTrigger>
            </Style.Triggers>
           </Style>
         </Border.Style>
        
        <Grid>
          <!-- Resize Border -->
          <Border x:Name="ResizeBorder" BorderThickness="5" BorderBrush="Transparent" Cursor="SizeAll" />
          
          <!-- Move Point and Delete -->
          <Grid Margin="0,2,0,0">
            <Grid.Style>
              <Style TargetType="{x:Type Grid}">
                <Setter Property="Visibility" Value="Collapsed" />
                <Style.Triggers>
                  <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                      <Condition Binding="{Binding IsEditOn, RelativeSource={RelativeSource AncestorType={x:Type uc:SegmentRectsControl}}}" Value="False" />
                      <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Border}}}" Value="True" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Visibility" Value="Visible" />
                  </MultiDataTrigger>
                </Style.Triggers>
              </Style>
            </Grid.Style>
            
            <!-- Move Point -->
            <mhc:Icon x:Name="MovePoint"
                      Size="12"
                      Source="{StaticResource IconDot}"
                      VerticalAlignment="Center"
                      HorizontalAlignment="Center"
                      Cursor="SizeAll" />

            <!-- Delete Segment -->
            <mhc:IconButton x:Name="BtnDelete"
                            Source="{StaticResource IconXCross}"
                            Size="10"
                            VerticalAlignment="Top"
                            HorizontalAlignment="Right"
                            ToolTip="Delete"
                            Margin="2,0"
                            Click="BtnDelete_Click" />
          </Grid>
        </Grid>
      </Border> 
    </DataTemplate>
  </UserControl.Resources>
  
  <ItemsControl ItemsSource="{Binding MediaItemSegmentsRects, RelativeSource={RelativeSource AncestorType={x:Type uc:SegmentRectsControl}}}"
                ItemTemplate="{StaticResource _segmentRect}">
    <ItemsControl.ItemsPanel>
      <ItemsPanelTemplate>
        <Grid Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type uc:SegmentRectsControl}}}"
              Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type uc:SegmentRectsControl}}}"/>
      </ItemsPanelTemplate>
    </ItemsControl.ItemsPanel>
  </ItemsControl>
</UserControl>
