<ResourceDictionary
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:vm="clr-namespace:PictureManager.ViewModels">

  <ResourceDictionary.MergedDictionaries>
    <ResourceDictionary Source="SegmentV.xaml" />
  </ResourceDictionary.MergedDictionaries>
  
  <DataTemplate
    x:Key="Views.SegmentsDrawerV"
    DataType="{x:Type vm:SegmentsDrawerVM}">

    <ContentPresenter
      Content="{Binding Panel}">
      
      <ContentPresenter.Resources>
        <Style
          TargetType="{x:Type ItemsControl}">

          <Setter
            Property="Margin"
            Value="2,0,0,0" />
          <Setter
            Property="ItemTemplate"
            Value="{StaticResource Views.SegmentV}" />
          <Setter
            Property="ItemsSource"
            Value="{Binding SegmentsM.SegmentsDrawer}" />
          <Setter
            Property="Template">
            <Setter.Value>
              <ControlTemplate>
                <ScrollViewer>
                  <ItemsPresenter />
                </ScrollViewer>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
          <Setter
            Property="ItemsPanel">
            <Setter.Value>
              <ItemsPanelTemplate>
                <WrapPanel />
              </ItemsPanelTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ContentPresenter.Resources>

      <b:Interaction.Triggers>
        <b:EventTrigger EventName="PreviewMouseUp">
          <b:InvokeCommandAction
            Command="{Binding SelectCommand}"
            EventArgsConverter="{StaticResource ClickConverter}"
            EventArgsConverterParameter="{StaticResource True}" />
        </b:EventTrigger>
      </b:Interaction.Triggers>
    </ContentPresenter>
  </DataTemplate>
</ResourceDictionary>