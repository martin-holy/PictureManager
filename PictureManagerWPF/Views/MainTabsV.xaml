<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:pm="clr-namespace:PictureManager"
                    xmlns:vm="clr-namespace:PictureManager.ViewModels"
                    xmlns:mhc="clr-namespace:MH.UI.WPF.Controls;assembly=MH.UI.WPF">

  <DataTemplate DataType="{x:Type vm:MainTabsVM}">
    <TabControl x:Name="Tabs"
                Background="Transparent"
                BorderThickness="0"
                TabStripPlacement="Left"
                ItemsSource="{Binding Items}"
                SelectedItem="{Binding Selected, Mode=TwoWay}">

      <TabControl.Style>
        <Style TargetType="{x:Type TabControl}">
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="{x:Type TabControl}">
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>

                  <StackPanel Grid.Column="0"
                              Orientation="Vertical"
                              ZIndex="1"
                              Width="46">

                    <mhc:IconButton Source="{StaticResource IconPlus}"
                                    Size="12"
                                    Padding="6"
                                    ShowShadow="False"
                                    ToolTip="Add Thumbnails Grid Tab"
                                    HorizontalAlignment="Center"
                                    Command="{Binding MediaItemsBaseVM.AddThumbnailsGridCommand,
                                              Source={x:Static pm:App.Ui}}" />

                    <TabPanel IsItemsHost="True"
                              KeyboardNavigation.TabIndex="1"
                              Margin="0"/>
                  </StackPanel>

                  <ContentPresenter Grid.Column="1"
                                    ContentSource="SelectedContent"
                                    KeyboardNavigation.DirectionalNavigation="Contained"
                                    KeyboardNavigation.TabIndex="2"
                                    KeyboardNavigation.TabNavigation="Local" />
                </Grid>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </TabControl.Style>

      <b:Interaction.Triggers>
        <b:EventTrigger EventName="SizeChanged">
          <b:InvokeCommandAction Command="{Binding UpdateTabHeadersSizeCommand}"
                                 CommandParameter="{Binding ActualHeight, ElementName=Tabs}"/>
        </b:EventTrigger>

        <b:EventTrigger EventName="SelectionChanged">
          <b:InvokeCommandAction Command="{Binding SelectionChangedCommand}"
                                 PassEventArgsToCommand="True" />
        </b:EventTrigger>
      </b:Interaction.Triggers>

      <TabControl.ItemContainerStyle>
        <Style TargetType="{x:Type TabItem}" BasedOn="{StaticResource MahApps.Styles.TabItem}">
          <Setter Property="MaxHeight" Value="{Binding DataContext.TabMaxHeight, ElementName=Tabs}" />
          <Setter Property="Header" Value="{Binding}" />
          <Setter Property="HeaderTemplate">
            <Setter.Value>
              <DataTemplate>
                <StackPanel x:Name="TabHeader"
                            Orientation="Vertical"
                            ToolTip="{Binding ToolTip}"
                            ContextMenu="{Binding ContextMenu}"
                            Background="Transparent">
                  
                  <Grid Height="28">
                    <!-- Close button -->
                    <mhc:IconButton Source="{StaticResource IconXCross}"
                                    Size="12"
                                    Padding="6"
                                    ShowShadow="False"
                                    ToolTip="Close"
                                    HorizontalAlignment="Center"
                                    Command="{Binding DataContext.TabCloseCommand, ElementName=Tabs}"
                                    CommandParameter="{Binding}"
                                    Visibility="{Binding IsMouseOver, ElementName=TabHeader,
                                                 Converter={StaticResource AllToVisibilityConverter}}"/>
                    
                    <!-- Tab Icon -->
                    <mhc:Icon Source="{Binding IconName, Converter={StaticResource IconNameToPathGeometryConverter}}"
                              Fill="{Binding IconName, Converter={StaticResource IconNameToBrushConverter}}"
                              Size="16"
                              ShowShadow="False"
                              HorizontalAlignment="Center">
                      <mhc:Icon.Style>
                        <Style TargetType="{x:Type mhc:Icon}" BasedOn="{StaticResource MH.UI.WPF.Controls.Icon}">
                          <Style.Triggers>
                            <DataTrigger Binding="{Binding IsMouseOver, ElementName=TabHeader}" Value="True">
                              <Setter Property="Visibility" Value="Hidden" />
                            </DataTrigger>
                          </Style.Triggers>
                        </Style>
                      </mhc:Icon.Style>
                      <mhc:Icon.LayoutTransform>
                        <RotateTransform Angle="270" />
                      </mhc:Icon.LayoutTransform>
                    </mhc:Icon>

                  </Grid>

                  <!-- Tab text -->
                  <TextBlock Text="{Binding Title}"
                             Margin="0,8"
                             FontSize="{DynamicResource MahApps.Font.Size.TabItem}">
                    <TextBlock.LayoutTransform>
                      <RotateTransform Angle="270" />
                    </TextBlock.LayoutTransform>
                  </TextBlock>
                  
                </StackPanel>
              </DataTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </TabControl.ItemContainerStyle>

    </TabControl>
  </DataTemplate>

</ResourceDictionary>