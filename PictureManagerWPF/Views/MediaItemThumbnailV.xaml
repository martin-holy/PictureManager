<ResourceDictionary
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:pmd="clr-namespace:PictureManager.Domain;assembly=PictureManager.Domain"
  xmlns:sys="clr-namespace:System;assembly=System.Runtime"
  xmlns:models="clr-namespace:PictureManager.Domain.Models;assembly=PictureManager.Domain">

  <DataTemplate DataType="{x:Type models:MediaItemM}">
    <DataTemplate.Resources>
      <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
          <ResourceDictionary Source="/MH.UI.WPF;component/Resources/EqualityConverterSigns.xaml"/>
        </ResourceDictionary.MergedDictionaries>

        <sys:Int32 x:Key="ThumbnailInfoMinSize">170</sys:Int32>
      </ResourceDictionary>
    </DataTemplate.Resources>

    <Border
      x:Name="border"
      Width="{Binding ThumbWidth}"
      Height="{Binding ThumbHeight}"
      BorderThickness="2"
      BorderBrush="Black"
      Margin="1"
      ClipToBounds="True">

      <Grid x:Name="PART_Grid">
        <!-- Thumbnail Image -->
        <Image
          Source="{Binding IsAsync=True, Converter={StaticResource MediaItemThumbnailSourceConverter}}"
          Stretch="Fill"/>

        <!-- Video over layer -->
        <ContentControl
          Content="&#xE29E;"
          FontFamily="Segoe UI Symbol"
          FontSize="20" 
          VerticalAlignment="Center"
          HorizontalAlignment="Center"
          Opacity="0.77"
          Visibility="{Binding MediaType, 
                       Converter={StaticResource AllToVisibilityConverter},
                       ConverterParameter={x:Static pmd:MediaType.Video}}">
        </ContentControl>

        <!-- Video Clips over layer -->
        <Path
          Style="{StaticResource MH.Styles.Icon}"
          Data="{StaticResource IconImageMultiple}"
          Width="20"
          Height="20"
          HorizontalAlignment="Right"
          VerticalAlignment="Bottom"
          Margin="5"
          Visibility="{Binding HasVideoClips, Converter={StaticResource AllToVisibilityConverter}}"/>

        <!-- Thumbnail Info Box -->
        <ItemsControl x:Name="info" ItemsSource="{Binding InfoBoxThumb}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>

          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Style="{StaticResource SBorderTextThumb}">
                <TextBlock
                  Style="{StaticResource STextBlock}"
                  TextWrapping="Wrap"
                  Text="{Binding}"/>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Selected over layer -->
        <Grid Visibility="{Binding IsSelected, Converter={StaticResource AllToVisibilityConverter}}">
          <Polygon
            Width="40"
            Height="40"
            Points="0,0 40,0 40,40"
            Stroke="Black"
            StrokeThickness="2"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Fill="{DynamicResource AccentColorBrush}"/>

          <Border
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            BorderThickness="2"
            BorderBrush="Black"/>
        </Grid>

      </Grid>
    </Border>

    <DataTemplate.Triggers>
      <DataTrigger Binding="{Binding IsSelected}" Value="True">
        <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentColorBrush}"/>
      </DataTrigger>

      <Trigger SourceName="border" Property="IsMouseOver" Value="True">
        <Setter TargetName="info" Property="Visibility" Value="Hidden"/>
      </Trigger>

      <DataTrigger Value="True">
        <DataTrigger.Binding>
          <MultiBinding Converter="{StaticResource EqualityConverter}">
            <Binding Path="ThumbWidth"/>
            <Binding Source="{StaticResource SignLessThan}"/>
            <Binding Source="{StaticResource ThumbnailInfoMinSize}"/>
          </MultiBinding>
        </DataTrigger.Binding>
        <Setter TargetName="info" Property="Visibility" Value="Hidden"/>
      </DataTrigger>
    </DataTemplate.Triggers>
  </DataTemplate>
</ResourceDictionary>