<ResourceDictionary
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:pmd="clr-namespace:PictureManager.Domain;assembly=PictureManager.Domain"
  xmlns:sys="clr-namespace:System;assembly=System.Runtime"
  xmlns:m="clr-namespace:PictureManager.Domain.Models;assembly=PictureManager.Domain"
  xmlns:vm="clr-namespace:PictureManager.ViewModels"
  xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:wpfu="clr-namespace:MH.UI.WPF.Utils;assembly=MH.UI.WPF"
  xmlns:pmConv="clr-namespace:PictureManager.Converters"
  xmlns:mhConv="clr-namespace:MH.UI.WPF.Converters;assembly=MH.UI.WPF">

  <DataTemplate DataType="{x:Type m:MediaItemM}">
    <DataTemplate.Resources>
      <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
          <wpfu:CachedResourceDictionary Source="/MH.UI.WPF;component/Resources/EqualityConverterSigns.xaml"/>
        </ResourceDictionary.MergedDictionaries>

        <sys:Double x:Key="ThumbnailInfoMinSize">170.0</sys:Double>
      </ResourceDictionary>
    </DataTemplate.Resources>

    <Grid x:Name="grid">
      <b:Interaction.Triggers>
        <b:EventTrigger EventName="MouseEnter">
          <b:InvokeCommandAction
            Command="vm:MediaItemVideoPreviewVM.ShowVideoPreviewCommand"
            CommandParameter="{Binding ElementName=grid}"/>
        </b:EventTrigger>

        <b:EventTrigger EventName="MouseLeave">
          <b:InvokeCommandAction Command="vm:MediaItemVideoPreviewVM.HideVideoPreviewCommand"/>
        </b:EventTrigger>
      </b:Interaction.Triggers>

      <!-- Thumbnail Image -->
      <Image
        Source="{Binding IsAsync=True, Converter={pmConv:MediaItemThumbSourceConverter}}"
        Stretch="Fill"/>

      <!-- Video over layer -->
      <ContentControl
        Content="&#xE29E;"
        FontFamily="Segoe UI Symbol"
        FontSize="20" 
        VerticalAlignment="Center"
        HorizontalAlignment="Center"
        Opacity="0.77"
        Visibility="{Binding MediaType, 
                     Converter={mhConv:AllToVisibilityConverter},
                     ConverterParameter={x:Static pmd:MediaType.Video}}"/>

      <!-- Video Clips over layer -->
      <Path
        Style="{StaticResource MH.Styles.Icon}"
        Data="{StaticResource IconImageMultiple}"
        Width="20"
        Height="20"
        HorizontalAlignment="Right"
        VerticalAlignment="Bottom"
        Margin="5"
        Visibility="{Binding HasVideoClips, Converter={mhConv:AllToVisibilityConverter}}"/>

      <!-- Thumbnail Info Box -->
      <ItemsControl
        x:Name="info"
        ItemsSource="{Binding InfoBoxThumb}"
        Style="{StaticResource InfoBoxThumbStyle}"/>
    </Grid>
    
    <DataTemplate.Triggers>
      <DataTrigger Value="True">
        <DataTrigger.Binding>
          <MultiBinding Converter="{mhConv:EqualityConverter}">
            <Binding Path="ActualWidth" ElementName="border"/>
            <Binding Source="{StaticResource SignLessThan}"/>
            <Binding Source="{StaticResource ThumbnailInfoMinSize}"/>
          </MultiBinding>
        </DataTrigger.Binding>
        <Setter TargetName="info" Property="Visibility" Value="Hidden"/>
      </DataTrigger>
    </DataTemplate.Triggers>
  </DataTemplate>
</ResourceDictionary>