<ResourceDictionary
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:pm="clr-namespace:PictureManager"
  xmlns:rd="clr-namespace:PictureManager.ResourceDictionaries"
  xmlns:m="clr-namespace:PictureManager.Domain.Models;assembly=PictureManager.Domain">

  <HierarchicalDataTemplate DataType="{x:Type m:RatingTreeM}">
    <HierarchicalDataTemplate.Resources>
      <ContextMenu
        x:Key="TreeContextMenuRating"
        DataContext="{Binding PlacementTarget.(FrameworkElement.DataContext),
                      RelativeSource={RelativeSource Self}}">

        <MenuItem
          Header="Load"
          Command="{Binding ThumbnailsGridsM.LoadByTagCommand,
                    Source={x:Static pm:App.Core}}"
          CommandParameter="{Binding}"/>
      </ContextMenu>
    </HierarchicalDataTemplate.Resources>

    <Grid Background="{Binding DisplayFilter,
                       Converter={StaticResource ResourceConverter},
                       ConverterParameter={x:Static rd:Dictionaries.DisplayFilterToBrush},
                       FallbackValue={StaticResource TransparentBrush}}">
      <b:Interaction.Triggers>
        <!-- Attach ContextMenu -->
        <b:EventTrigger EventName="PreviewMouseRightButtonDown">
          <b:ChangePropertyAction
            PropertyName="ContextMenu"
            Value="{StaticResource TreeContextMenuRating}"/>
        </b:EventTrigger>
      </b:Interaction.Triggers>

      <StackPanel Orientation="Horizontal" Margin="18,0,0,0">
        <StackPanel Orientation="Horizontal">
          <StackPanel.Resources>
            <Style TargetType="{x:Type Path}" BasedOn="{StaticResource MH.Styles.Icon}">
              <Setter Property="Data" Value="{StaticResource IconStar}"/>
            </Style>
          </StackPanel.Resources>

          <Path Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=0}"/>
          <Path Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=1}"/>
          <Path Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=2}"/>
          <Path Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=3}"/>
          <Path Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=4}"/>
        </StackPanel>
        <TextBlock Style="{StaticResource TreeItemKeywordsPicCount}"/>
      </StackPanel>
    </Grid>
  </HierarchicalDataTemplate>
</ResourceDictionary>