<ResourceDictionary
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:vm="clr-namespace:PictureManager.ViewModels"
  xmlns:mhc="clr-namespace:MH.UI.WPF.Controls;assembly=MH.UI.WPF"
  xmlns:rd="clr-namespace:PictureManager.ResourceDictionaries">

  <DataTemplate DataType="{x:Type vm:TreeViewSearchVM}">
    <Grid
      Margin="4"
      Visibility="{Binding IsVisible,
                   Converter={StaticResource AllToVisibilityConverter}}">

      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      
      <!-- Search Box -->
      <Grid Grid.Row="0">
        <TextBox
          Text="{Binding SearchText,
                 UpdateSourceTrigger=PropertyChanged}" 
          FontSize="16">

          <TextBox.Style>
            <Style
              TargetType="{x:Type TextBox}"
              BasedOn="{StaticResource StyleBaseTextBox}">

              <Style.Triggers>
                <Trigger
                  Property="IsVisible"
                  Value="True">

                  <Setter
                    Property="FocusManager.FocusedElement"
                    Value="{Binding RelativeSource={RelativeSource Self}}" />
                </Trigger>
              </Style.Triggers>
            </Style>
          </TextBox.Style>
        </TextBox>

        <mhc:IconButton
          Source="{StaticResource IconXCross}"
          Size="12"
          HorizontalAlignment="Right"
          VerticalAlignment="Center"
          Margin="0,0,4,0"
          Command="{Binding CloseCommand}" />
      </Grid>

      <!-- Search Result -->
      <ListBox
        Grid.Row="1"
        ItemsSource="{Binding SearchResult}"
        MaxHeight="400"
        Visibility="{Binding SearchResult.Count,
                     Converter={StaticResource AllToVisibilityConverter}}">

        <ListBox.ItemTemplate>
          <DataTemplate>
            <StackPanel
              Orientation="Horizontal"
              Background="Transparent"
              ToolTip="{Binding ToolTip}">

              <StackPanel.InputBindings>
                <MouseBinding
                  MouseAction="LeftClick"
                  Command="{Binding DataContext.NavigateToCommand,
                            RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}"
                  CommandParameter="{Binding}" />
              </StackPanel.InputBindings>

              <mhc:Icon
                Source="{Binding IconName,
                         Converter={StaticResource ResourceConverter}}"
                Fill="{Binding IconName,
                       Converter={StaticResource ResourceConverter},
                       ConverterParameter={x:Static rd:Dictionaries.IconNameToBrush},
                       FallbackValue={StaticResource ColorBrushWhite}}" />

              <TextBlock
                Text="{Binding Title}"
                Margin="4" />

            </StackPanel>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
      
    </Grid>
  </DataTemplate>
    
</ResourceDictionary>