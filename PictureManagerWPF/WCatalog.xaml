<controls:MetroWindow x:Class="PictureManager.WCatalog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:viewModel="clr-namespace:PictureManager.ViewModel"
        mc:Ignorable="d"
        BorderBrush="{DynamicResource AccentColorBrush}" 
        Background="{DynamicResource WhiteBrush}" 
        FontSize="13.333"
        DataContext="{Binding RelativeSource={RelativeSource Self}}"
        Title="Catalog" Height="300" Width="400" WindowStartupLocation="CenterOwner" TitleCaps="False">
  <controls:MetroWindow.Resources>
    <RoutedUICommand x:Key="FolderAdd" Text="Add folder" />
    <RoutedUICommand x:Key="FolderRemove" Text="Remove folder" />
  </controls:MetroWindow.Resources>

  <controls:MetroWindow.CommandBindings>
    <CommandBinding Command="{StaticResource FolderAdd}" Executed="CmdFolderAdd" />
    <CommandBinding Command="{StaticResource FolderRemove}" Executed="CmdFolderRemove" />
  </controls:MetroWindow.CommandBindings>

  <DockPanel>
    <Grid DockPanel.Dock="Bottom">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <ProgressBar Grid.ColumnSpan="3" x:Name="PbUpdateProgress" Height="20" Margin="5,10,5,10" />
      <Label Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" Content="{Binding FilesProgress}" x:Name="LblFilesProgress" HorizontalAlignment="Center" VerticalAlignment="Center" />
      <!--<Label Grid.Column="0" Grid.Row="1" Content="{Binding TimeElapsed}" x:Name="LblTimeElapsed" />
      <Label Grid.Column="1" Grid.Row="1" Content="{Binding TimeRemaining}" x:Name="LblTimeRemaining" />-->

      <CheckBox Grid.Column="0" Grid.Row="1" Margin="5,0" x:Name="ChbRebuildThumbs" Content="Rebuild thumbnails" />
      <CheckBox Grid.Column="1" Grid.Row="1" Margin="5,0" x:Name="ChbNewOnly" IsChecked="True" Content="New only" />

      <StackPanel Grid.Column="2" Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,5,0">
        <Button Margin="3,0,0,3" Content="Update" x:Name="BtnUpdate" Click="BtnUpdate_OnClick" />
        <Button Margin="3,0,0,3" Content="Cancel" x:Name="BtnCancel" Click="BtnCancel_OnClick" />
      </StackPanel>
    </Grid>

    <TreeView x:Name="TvFolders">

      <TreeView.ItemContainerStyle>
        <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource MetroTreeViewItem}">
          <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
          <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
          <Setter Property="ToolTip" Value="{Binding FullPath}" />
          <Setter Property="VerticalContentAlignment" Value="Stretch" />
          <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        </Style>
      </TreeView.ItemContainerStyle>

      <TreeView.Resources>
        <!-- TreeView Folders - BaseItem (Category) -->
        <HierarchicalDataTemplate DataType="{x:Type viewModel:BaseTreeViewItem}" ItemsSource="{Binding Items}">
          <StackPanel Orientation="Horizontal" Background="Transparent" PreviewMouseRightButtonDown="AttachContextMenu">
            <Rectangle Style="{StaticResource IconRect}" />
            <TextBlock Style="{StaticResource TreeViewTitle}" />
          </StackPanel>
        </HierarchicalDataTemplate>

        <!-- TreeView Folders - Folder -->
        <HierarchicalDataTemplate DataType="{x:Type viewModel:Folder}" ItemsSource="{Binding Items}">
          <StackPanel Orientation="Horizontal" Background="Transparent" PreviewMouseRightButtonDown="AttachContextMenu">
            <Rectangle Style="{StaticResource IconRect}" />
            <TextBlock Style="{StaticResource TreeViewTitle}" />
          </StackPanel>
        </HierarchicalDataTemplate>
      </TreeView.Resources>
    </TreeView>
  </DockPanel>
</controls:MetroWindow>
