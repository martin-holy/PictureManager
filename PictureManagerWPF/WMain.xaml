<controls:MetroWindow x:Name="MainWindow" x:Class="PictureManager.WMain"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:pm="clr-namespace:PictureManager"
        xmlns:viewModel="clr-namespace:PictureManager.ViewModel"
        xmlns:userControls="clr-namespace:PictureManager.UserControls"
        xmlns:media="https://github.com/JohanLarsson/Gu.Wpf.Media"
        mc:Ignorable="d"
        DataContext="{Binding RelativeSource={RelativeSource Self}}"
        Title="Picture Manager" TitleAlignment="Center" Height="550" Width="930" WindowState="Maximized" 
        Loaded="Window_Loaded" FontSize="13.333" SaveWindowPosition="True" TitleCharacterCasing="Normal"
        LeftWindowCommandsOverlayBehavior="Never" MouseMove="WMain_OnMouseMove">

  <controls:MetroWindow.TitleTemplate>
    <DataTemplate>
      <Grid DataContext="{Binding ElementName=MainWindow, Path=DataContext}">
        <ProgressBar Width="250" Height="22" Value="{Binding ACore.AppInfo.ProgressBarValue}" Maximum="100" />
        <TextBlock Text="{TemplateBinding Content}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" HorizontalAlignment="Center"
                   Margin="8 -1 8 0" FontWeight="Bold" FontSize="{DynamicResource WindowTitleFontSize}"
                   FontFamily="{DynamicResource HeaderFontFamily}" />
      </Grid>
    </DataTemplate>
  </controls:MetroWindow.TitleTemplate>

  <controls:MetroWindow.LeftWindowCommands>
    <controls:WindowCommands>
      <Menu x:Name="MainMenu" Background="Transparent">
        <MenuItem Header="Tools" Style="{StaticResource RootMenuStyle}">
          <MenuItem Command="pm:Commands.CompressPictures" />
          <MenuItem Command="pm:Commands.ReloadMetadata" />
          <MenuItem Command="pm:Commands.OpenCatalog" />
          <MenuItem Command="pm:Commands.OpenSettings" Tag="appbar_settings" Style="{StaticResource MenuItemIcon}" />
          <MenuItem Command="pm:Commands.AddGeoNamesFromFiles" Tag="appbar_location_checkin" Style="{StaticResource MenuItemIcon}" />
          <MenuItem Command="pm:Commands.TestButton" />
        </MenuItem>
        <MenuItem Header="Keywords" Style="{StaticResource RootMenuStyle}">
          <MenuItem Command="pm:Commands.KeywordsEdit" Tag="appbar_edit" Style="{StaticResource MenuItemIcon}" />
          <MenuItem Command="pm:Commands.KeywordsSave" Tag="appbar_save" Style="{StaticResource MenuItemIcon}" />
          <MenuItem Command="pm:Commands.KeywordsCancel" Tag="appbar_cancel" Style="{StaticResource MenuItemIcon}" />
          <MenuItem Command="pm:Commands.KeywordsComment" Tag="appbar_notification" Style="{StaticResource MenuItemIcon}" />
        </MenuItem>
        <MenuItem Header="Viewer" x:Name="MenuViewers" Tag="appbar_eye" Style="{StaticResource RootMenuStyle}" 
                  Icon="{StaticResource MenuItemIconRect}" ItemsSource="{Binding ElementName=MainWindow, Path=DataContext.ACore.Viewers.Items}">
          <MenuItem.ItemContainerStyle>
            <Style TargetType="MenuItem" BasedOn="{StaticResource MenuItemIcon}">
              <Setter Property="Header" Value="{Binding Title}" />
              <Setter Property="Tag" Value="appbar_eye" />
              <Setter Property="Command" Value="pm:Commands.ViewerChange" />
              <Setter Property="CommandParameter" Value="{Binding}" />
            </Style>
          </MenuItem.ItemContainerStyle>
        </MenuItem>
        <MenuItem Command="pm:Commands.OpenAbout" Style="{StaticResource RootMenuStyle}" />
        <MenuItem Command="pm:Commands.ShowHideTabMain" Style="{StaticResource RootMenuStyle}" />
      </Menu>
    </controls:WindowCommands>
  </controls:MetroWindow.LeftWindowCommands>

  <controls:MetroWindow.Resources>
    <!-- KeywordsPicCountStyle -->
    <Style x:Key="KeywordsPicCountStyle" TargetType="{x:Type TextBlock}">
      <Setter Property="Text" Value="{Binding PicCount}" />
      <Setter Property="Visibility" Value="Collapsed"/>
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="Margin" Value="5,0,0,0" />
      <Setter Property="Padding" Value="5,0" />
      <Setter Property="Background" Value="{DynamicResource AccentColorBrush4}" />
      <Style.Triggers>
        <DataTrigger Binding="{Binding IsMarked}" Value="True">
          <Setter Property="Visibility" Value="Visible"/>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <!-- TreeViewStackPanel -->
    <Style x:Key="TreeViewStackPanel" TargetType="StackPanel">
      <Setter Property="Orientation" Value="Horizontal" />
      <Setter Property="Background" Value="Transparent" />
      <EventSetter Event="PreviewMouseRightButtonDown" Handler="AttachContextMenu" />
      <EventSetter Event="PreviewMouseUp" Handler="TreeView_Select" />
    </Style>

    <!-- TreeViewKeywordsStackPanelWithDragDrop -->
    <Style x:Key="TreeViewKeywordsStackPanelWithDragDrop" BasedOn="{StaticResource TreeViewStackPanel}" TargetType="StackPanel">
      <Setter Property="AllowDrop" Value="True" />
      <EventSetter Event="Drop" Handler="TvKeywords_OnDrop" />
      <EventSetter Event="MouseLeftButtonDown" Handler="TvKeywords_OnMouseLeftButtonDown" />
      <EventSetter Event="MouseLeftButtonUp" Handler="TvKeywords_OnMouseLeftButtonUp" />
      <EventSetter Event="MouseMove" Handler="TvKeywords_OnMouseMove" />
      <EventSetter Event="DragEnter" Handler="TvKeywords_AllowDropCheck" />
      <EventSetter Event="DragLeave" Handler="TvKeywords_AllowDropCheck" />
      <EventSetter Event="DragOver" Handler="TvKeywords_AllowDropCheck" />
    </Style>

    <!-- SBorderInfoBoxThumb SBorderInfoBoxStatusBar STextBlockInfoBox -->
    <Style x:Key="SBorderInfoBoxThumb" TargetType="Border">
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="BorderBrush" Value="Black" />
      <Setter Property="Background" Value="#88000000" />
      <Setter Property="VerticalAlignment" Value="Top"/>
      <Setter Property="Margin" Value="5,5,0,0"/>
      <Setter Property="Padding" Value="2,0,2,1" />
      <Setter Property="CornerRadius" Value="5" />
    </Style>
    <Style x:Key="SBorderInfoBoxStatusBar" TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxThumb}">
      <Setter Property="Margin" Value="3,0,0,3"/>
      <Setter Property="MinWidth" Value="20" />
    </Style>
    <Style x:Key="STextBlockInfoBox" TargetType="TextBlock">
      <Setter Property="Foreground" Value="White" />
      <Setter Property="HorizontalAlignment" Value="Center" />
    </Style>
  </controls:MetroWindow.Resources>

  <controls:MetroWindow.Flyouts>
    <controls:FlyoutsControl>
      <controls:Flyout x:Name="FlyoutMainTreeView" Position="Left" Width="350" IsOpen="True" IsPinned="True" 
        Background="#FF252525" TitleVisibility="Collapsed" CloseButtonVisibility="Collapsed" MouseLeave="FlyoutMainTreeView_OnMouseLeave">
        <controls:Flyout.Style>
          <Style TargetType="controls:Flyout">
            <Setter Property="Margin" Value="0" />
            <Style.Triggers>
              <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="0">
                <Setter Property="Margin" Value="0,30,0,0" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </controls:Flyout.Style>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition>
              <RowDefinition.Style>
                <Style TargetType="RowDefinition">
                  <Setter Property="Height" Value="0" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding ElementName=FlyoutMainTreeView, Path=IsPinned}" Value="True">
                      <Setter Property="Height" Value="{Binding ElementName=FlyoutStatusPanel, Path=ActualHeight}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </RowDefinition.Style>
            </RowDefinition>
          </Grid.RowDefinitions>

          <!-- TreeView Forders, Keywords and Filters -->
          <TabControl x:Name="TcMain" Grid.Row="0" Background="Transparent" BorderThickness="0">
            <TabItem Header="Folders" x:Name="TabFolders" HorizontalAlignment="Left">
              <!-- TreeView Folders -->
              <TreeView x:Name="TvFolders" Background="Transparent" 
                      ItemsSource="{Binding ElementName=MainWindow, Path=DataContext.ACore.FoldersRoot}">

                <TreeView.ItemContainerStyle>
                  <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource MetroTreeViewItem}">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <Setter Property="VerticalContentAlignment" Value="Stretch" />
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Background" Value="Transparent" />
                  </Style>
                </TreeView.ItemContainerStyle>

                <TreeView.Resources>
                  <!-- TreeView Folders - BaseItem (Category) -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:BaseTreeViewItem}" ItemsSource="{Binding Items}">
                    <StackPanel Orientation="Horizontal" Background="Transparent" 
                            PreviewMouseRightButtonDown="AttachContextMenu" 
                            PreviewMouseUp="TreeView_Select">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Folders - Folder -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:Folder}" ItemsSource="{Binding Items}">
                    <StackPanel Orientation="Horizontal" Background="Transparent" AllowDrop="True"
                            MouseLeftButtonUp="TvFolders_OnMouseLeftButtonUp"
                            MouseLeftButtonDown="TvFolders_OnMouseLeftButtonDown"
                            PreviewMouseRightButtonDown="AttachContextMenu"
                            PreviewMouseUp="TreeView_Select" 
                            Drop="TvFolders_OnDrop" 
                            MouseMove="TvFolders_OnMouseMove" 
                            DragEnter="TvFolders_AllowDropCheck" 
                            DragLeave="TvFolders_AllowDropCheck"
                            DragOver="TvFolders_AllowDropCheck">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>
                </TreeView.Resources>
              </TreeView>
            </TabItem>

            <TabItem Header="Keywords" x:Name="TabKeywords" HorizontalAlignment="Left">
              <!-- TreeView Keywords -->
              <TreeView x:Name="TvKeywords" Background="Transparent"
                      ItemsSource="{Binding ElementName=MainWindow, Path=DataContext.ACore.KeywordsRoot}">

                <TreeView.ItemContainerStyle>
                  <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource MetroTreeViewItem}">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <Setter Property="VerticalContentAlignment" Value="Stretch" />
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Background" Value="{Binding BackgroundBrush, Converter={StaticResource BgColorConverter}}" />
                    <Style.Triggers>
                      <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                          <Condition Binding="{Binding IsMarked}" Value="True" />
                          <Condition Binding="{Binding BgBrush}" Value="0" />
                        </MultiDataTrigger.Conditions>
                        <Setter Property="Background" Value="{DynamicResource AccentColorBrush4}" />
                      </MultiDataTrigger>
                    </Style.Triggers>
                  </Style>
                </TreeView.ItemContainerStyle>

                <TreeView.Resources>
                  <!-- TreeView Keywords - BaseItem (Category) -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:BaseTreeViewItem}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewKeywordsStackPanelWithDragDrop}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - Keyword -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:Keyword}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewKeywordsStackPanelWithDragDrop}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - FolderKeyword -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:FolderKeyword}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - GeoName -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:GeoName}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - CategoryGroup -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:CategoryGroup}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewKeywordsStackPanelWithDragDrop}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - Person -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:Person}">
                    <StackPanel Style="{StaticResource TreeViewKeywordsStackPanelWithDragDrop}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - Rating -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:Rating}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <StackPanel Orientation="Horizontal">
                        <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=0}" />
                        <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=1}" />
                        <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=2}" />
                        <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=3}" />
                        <Rectangle Style="{StaticResource IconRect}" Fill="{Binding Value, Converter={StaticResource RatingConverter}, ConverterParameter=4}" />
                      </StackPanel>
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Keywords - MediaItemSize -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:MediaItemSize}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}" Margin="0,0,3,3">
                      <Grid Width="{Binding ActualWidth, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type StackPanel}}}">
                        <Grid.RowDefinitions>
                          <RowDefinition />
                          <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition />
                          <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <TextBlock HorizontalAlignment="Left" Grid.Row="0" Grid.Column="0" 
                        Text="{Binding PixelMin, Converter={StaticResource MediaItemSizeConverter}}" />
                        <TextBlock HorizontalAlignment="Right" Grid.Row="0" Grid.Column="1" 
                        Text="{Binding PixelMax, Converter={StaticResource MediaItemSizeConverter}}" />

                        <controls:RangeSlider Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                        HorizontalAlignment="Stretch" MoveWholeRange="True" 
                        Minimum="{Binding Min}" Maximum="{Binding Max}"
                        LowerValue="{Binding PixelMin}" UpperValue="{Binding PixelMax}" 
                        UpperThumbDragCompleted="MediaItemSize_OnDragCompleted"
                        LowerThumbDragCompleted="MediaItemSize_OnDragCompleted"
                        CentralThumbDragCompleted="MediaItemSize_OnDragCompleted"
                        IsSnapToTickEnabled="True" TickFrequency="0.1" />
                      </Grid>
                    </StackPanel>
                  </HierarchicalDataTemplate>
                </TreeView.Resources>

              </TreeView>
            </TabItem>

            <TabItem Header="Filters" HorizontalAlignment="Left">
              <!-- TreeView Filters -->
              <TreeView x:Name="TvFilters" Background="Transparent"
                      ItemsSource="{Binding ElementName=MainWindow, Path=DataContext.ACore.FiltersRoot}">

                <TreeView.ItemContainerStyle>
                  <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource MetroTreeViewItem}">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <Setter Property="ToolTip" Value="{Binding ToolTip}" />
                    <Setter Property="VerticalContentAlignment" Value="Stretch" />
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Background" Value="Transparent" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding IsMarked}" Value="True">
                        <Setter Property="Background" Value="{DynamicResource AccentColorBrush4}" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TreeView.ItemContainerStyle>

                <TreeView.Resources>
                  <!-- TreeView Filters - BaseItem (Category) -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:BaseTreeViewItem}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Filters - Filter -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:Filter}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                      <TextBlock Style="{StaticResource KeywordsPicCountStyle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Filters - Viewer -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:Viewer}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>

                  <!-- TreeView Filters - SqlQuery -->
                  <HierarchicalDataTemplate DataType="{x:Type viewModel:SqlQuery}" ItemsSource="{Binding Items}">
                    <StackPanel Style="{StaticResource TreeViewStackPanel}">
                      <Rectangle Style="{StaticResource IconRect}" />
                      <TextBlock Style="{StaticResource TreeViewTitle}" />
                    </StackPanel>
                  </HierarchicalDataTemplate>
                </TreeView.Resources>

              </TreeView>
            </TabItem>
          </TabControl>

        </Grid>
      </controls:Flyout>

      <!-- Status Panel -->
      <controls:Flyout x:Name="FlyoutStatusPanel" Position="Bottom" Height="Auto" IsOpen="True" IsHitTestVisible="False" 
        Background="Transparent" TitleVisibility="Collapsed" CloseButtonVisibility="Collapsed">
        <WrapPanel x:Name="StatusPanel" VerticalAlignment="Bottom" Height="Auto" Margin="0,0,0,1">
          <WrapPanel.Style>
            <Style>
              <Style.Resources>
                <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}" />
              </Style.Resources>
            </Style>
          </WrapPanel.Style>

          <!-- PositionSlashCount -->
          <Border>
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.MediaItems.Items.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding ACore.AppInfo.PositionSlashCount}" />
          </Border>

          <!-- Selected -->
          <Border Background="{DynamicResource AccentColorBrush}">
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="1">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                  <DataTrigger Binding="{Binding ACore.MediaItems.Items.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding ACore.AppInfo.Selected}" />
          </Border>

          <!-- Modifed -->
          <Border Background="#CA5100">
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.MediaItems.IsEditModeOn}" Value="False">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding ACore.AppInfo.Modifed}" />
          </Border>

          <!-- Dimension -->
          <Border>
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.Dimension}" Value="">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding ACore.AppInfo.Dimension}" />
          </Border>

          <!-- Rating -->
          <Border>
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.Rating.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <ItemsControl ItemsSource="{Binding ACore.AppInfo.Rating}">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <StackPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Rectangle Style="{StaticResource IconRect}" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </Border>

          <!-- FilePath -->
          <Border>
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Setter Property="IsHitTestVisible" Value="True" />
                <Setter Property="ToolTip" Value="sdfsd" />
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.FilePath}" Value="">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding ACore.AppInfo.FilePath}" />
          </Border>

          <!-- People -->
          <ItemsControl ItemsSource="{Binding ACore.AppInfo.CurrentMediaItem.InfoBoxPeople}">
            <ItemsControl.Style>
              <Style TargetType="ItemsControl">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.CurrentMediaItem.InfoBoxPeople.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                  <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </ItemsControl.Style>
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Style="{StaticResource SBorderInfoBoxStatusBar}">
                  <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding}" />
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Keywords -->
          <ItemsControl ItemsSource="{Binding ACore.AppInfo.CurrentMediaItem.InfoBoxKeywords}">
            <ItemsControl.Style>
              <Style TargetType="ItemsControl">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.CurrentMediaItem.InfoBoxKeywords.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                  <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </ItemsControl.Style>
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Style="{StaticResource SBorderInfoBoxStatusBar}">
                  <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding}" />
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Comment -->
          <Border>
            <Border.Style>
              <Style TargetType="Border" BasedOn="{StaticResource SBorderInfoBoxStatusBar}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ACore.AppInfo.Comment}" Value="">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                  <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding ACore.AppInfo.Comment}" />
          </Border>

        </WrapPanel>
      </controls:Flyout>

    </controls:FlyoutsControl>
  </controls:MetroWindow.Flyouts>

  <Grid DataContext="{Binding ElementName=MainWindow, Path=DataContext}">
    <Grid x:Name="GridMain" Margin="0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="350" />
        <ColumnDefinition Width="3" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <GridSplitter Grid.Column="1" DragDelta="MainSplitter_OnDragDelta" DragCompleted="MainSplitter_OnDragCompleted" 
        Width="3" HorizontalAlignment="Stretch" Background="{StaticResource WhiteBrush}" />

      <!-- Thumbnails and Full Media -->
      <Grid Grid.Column="2" >

        <!-- Thumbnails -->
        <Grid>
          <Grid.Style>
            <Style TargetType="{x:Type Grid}">
              <Setter Property="Visibility" Value="Hidden" />
              <Style.Triggers>
                <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="0">
                  <Setter Property="Visibility" Value="Visible" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Grid.Style>

          <!-- Thumbnails -->
          <ItemsControl x:Name="ThumbsBox" ItemsSource="{Binding ACore.MediaItems.SplitedItems}"
                        VirtualizingStackPanel.IsVirtualizing="True" 
                        VirtualizingPanel.ScrollUnit="Pixel" 
                        ScrollViewer.CanContentScroll="True" PreviewMouseWheel="ThumbsBox_OnPreviewMouseWheel">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <VirtualizingStackPanel CacheLengthUnit="Item" CacheLength="4"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <ItemsControl ItemsSource="{Binding}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>

                  <!-- Thumbnail -->
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Width="{Binding ThumbWidth}" Height="{Binding ThumbHeight}" ClipToBounds="True"
                              MouseLeftButtonUp="Thumb_OnMouseLeftButtonUp" MouseLeftButtonDown="Thumb_OnMouseLeftButtonDown" 
                              MouseMove="Thumb_OnMouseMove">
                        <Border.Style>
                          <Style TargetType="{x:Type Border}">
                            <Setter Property="BorderBrush" Value="Black" />
                            <Setter Property="BorderThickness" Value="2" />
                            <Setter Property="Margin" Value="2,0,0,2" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BorderBrush" Value="{DynamicResource AccentColorBrush}" />
                              </DataTrigger>
                            </Style.Triggers>
                            <Style.Resources>
                              <Style TargetType="{x:Type ItemsControl}">
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=IsMouseOver}" Value="True">
                                    <Setter Property="Visibility" Value="Hidden"/>
                                  </DataTrigger>
                                  <DataTrigger Binding="{Binding ElementName=MainWindow, Path=DataContext.ACore.AppInfo.IsThumbInfoVisible}" Value="False">
                                    <Setter Property="Visibility" Value="Hidden"/>
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </Style.Resources>
                          </Style>
                        </Border.Style>

                        <Grid>
                          <!-- Thumbnail Image -->
                          <Image Source="{Binding FilePathCacheUri, Converter={StaticResource ImageSourceConverter}}" Stretch="Fill" />

                          <!-- Video overlayer -->
                          <ContentControl Content="&#xE29E;" FontFamily="Segoe UI Symbol" FontSize="20" 
                                          VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.77">
                            <ContentControl.Style>
                              <Style>
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding MediaType}" Value="0">
                                    <Setter Property="ContentControl.Visibility" Value="Hidden"/>
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </ContentControl.Style>
                          </ContentControl>

                          <!-- Thumbnail Info Box -->
                          <ItemsControl ItemsSource="{Binding InfoBoxThumb}">
                            <ItemsControl.ItemsPanel>
                              <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                              </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                              <DataTemplate>
                                <Border Style="{StaticResource SBorderInfoBoxThumb}">
                                  <TextBlock Style="{StaticResource STextBlockInfoBox}" Text="{Binding}" />
                                </Border>
                              </DataTemplate>
                            </ItemsControl.ItemTemplate>
                          </ItemsControl>
                        </Grid>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </DataTemplate>
            </ItemsControl.ItemTemplate>

            <ItemsControl.Template>
              <ControlTemplate>
                <ScrollViewer x:Name="ThumbsBoxScrollViewer">
                  <ItemsPresenter />
                </ScrollViewer>
              </ControlTemplate>
            </ItemsControl.Template>
          </ItemsControl>
        </Grid>

        <!-- Full Media -->
        <Grid x:Name="PanelFullScreen" Background="Transparent" 
              MouseLeftButtonDown="PanelFullScreen_OnMouseLeftButtonDown" MouseWheel="PanelFullScreen_OnMouseWheel">
          <Grid.Style>
            <Style TargetType="{x:Type Grid}">
              <Setter Property="Visibility" Value="Hidden" />
              <Style.Triggers>
                <DataTrigger Binding="{Binding ACore.AppInfo.AppMode}" Value="1">
                  <Setter Property="Visibility" Value="Visible" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Grid.Style>
          <Grid>

            <!-- Full Media Image -->
            <Grid>
              <Grid.Style>
                <Style TargetType="{x:Type Grid}">
                  <Setter Property="Visibility" Value="Hidden" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding ACore.MediaItems.Current.MediaType}" Value="0">
                      <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Grid.Style>

              <userControls:ZoomImageBox x:Name="FullImage" />
            </Grid>

            <!-- Full Media Video -->
            <Grid>
              <Grid.Style>
                <Style TargetType="{x:Type Grid}">
                  <Setter Property="Visibility" Value="Hidden" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding ACore.MediaItems.Current.MediaType}" Value="1">
                      <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Grid.Style>

              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
              </Grid.RowDefinitions>

              <media:MediaElementWrapper x:Name="FullMedia" Grid.Row="0" Grid.RowSpan="2" LoadedBehavior="Play"
                ScrubbingEnabled="True" Stretch="Uniform" MediaEnded="FullMedia_OnMediaEnded" />

              <Grid Grid.Row="0" VerticalAlignment="Bottom">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Slider x:Name="ProgressSlider" Grid.Row="0" Minimum="0"
                  media:Drag.PauseWhileDragging="{Binding ElementName=FullMedia}"
                  IsEnabled="{Binding ElementName=FullMedia, Path=HasMedia}"
                  Maximum="{Binding ElementName=FullMedia, Path=Length, Converter={x:Static media:NullableTimeSpanToSecondsConverter.Default}}"
                  Style="{StaticResource {x:Static media:Styles.ProgressSliderStyleKey}}"
                  Value="{Binding ElementName=FullMedia, Path=Position, Converter={x:Static media:NullableTimeSpanToSecondsConverter.Default}}" />
              </Grid>
            </Grid>
          </Grid>
        </Grid>
      </Grid>
    </Grid>

    

  </Grid>
</controls:MetroWindow>
