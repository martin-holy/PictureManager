<controls:MetroWindow x:Name="MainWindow" x:Class="PictureManager.WMain"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:data="clr-namespace:PictureManager.Data"
        xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        mc:Ignorable="d"
        Title="Picture Manager" Height="547.5" Width="932.674" WindowState="Maximized" 
        Loaded="Window_Loaded" 
        Closing="Window_Closing" 
        FontSize="13.333" 
        SaveWindowPosition="True" TitleCaps="False">
  <controls:MetroWindow.Resources>
    <Style TargetType="{x:Type controls:MetroWindow}">
      <Setter Property="controls:ControlsHelper.ContentCharacterCasing" Value="Normal" />
    </Style>
    <Style x:Key="KeywordsPicCountStyle" TargetType="{x:Type TextBlock}">
      <Setter Property="Visibility" Value="Collapsed"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding IsMarked}" Value="True">
          <Setter Property="Visibility" Value="Visible"/>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <RoutedUICommand x:Key="KeywordShowAll" Text="Show all (recursive)" />
    <RoutedUICommand x:Key="KeywordNew" Text="New" />
    <RoutedUICommand x:Key="KeywordRename" Text="Rename" />
    <RoutedUICommand x:Key="KeywordDelete" Text="Delete" />
    <RoutedUICommand x:Key="FolderRename" Text="Rename" />
    <RoutedUICommand x:Key="FolderAddToFavorites" Text="Add to Favorites" />
    <RoutedUICommand x:Key="FolderRemoveFromFavorites" Text="Remove from Favorites" />
    <RoutedUICommand x:Key="OpenSettings" />
    <RoutedUICommand x:Key="KeywordsEditMode" />
    <RoutedUICommand x:Key="KeywordsEditModeSave" />
    <RoutedUICommand x:Key="KeywordsEditModeCancel" />
    <RoutedUICommand x:Key="About" />
    <RoutedUICommand x:Key="TestButton" />
  </controls:MetroWindow.Resources>

  <controls:MetroWindow.CommandBindings>
    <CommandBinding Command="{StaticResource KeywordShowAll}" Executed="CmdKeywordShowAll" />
    <CommandBinding Command="{StaticResource KeywordNew}" Executed="CmdKeywordNew" />
    <CommandBinding Command="{StaticResource KeywordRename}" Executed="CmdKeywordRename" />
    <CommandBinding Command="{StaticResource KeywordDelete}" Executed="CmdKeywordDelete" />
    <CommandBinding Command="{StaticResource FolderRename}" Executed="CmdFolderRename" />
    <CommandBinding Command="{StaticResource FolderAddToFavorites}" Executed="CmdFolderAddToFavorites" />
    <CommandBinding Command="{StaticResource FolderRemoveFromFavorites}" Executed="CmdFolderRemoveFromFavorites" />
    <CommandBinding Command="{StaticResource OpenSettings}" Executed="CmdOpenSettings" />
    <CommandBinding Command="{StaticResource KeywordsEditMode}" Executed="CmdKeywordsEditMode" />
    <CommandBinding Command="{StaticResource KeywordsEditModeSave}" Executed="CmdKeywordsEditModeSave" />
    <CommandBinding Command="{StaticResource KeywordsEditModeCancel}" Executed="CmdKeywordsEditModeCancel" />
    <CommandBinding Command="{StaticResource About}" Executed="CmdAbout" />
    <CommandBinding Command="{StaticResource TestButton}" Executed="CmdTestButton" />
  </controls:MetroWindow.CommandBindings>

  <DockPanel >
    <ToolBarTray DockPanel.Dock="Top">
      <ToolBar Height="36">
        <Button Command="{StaticResource TestButton}" ToolTip="Test Button">
          <StackPanel Orientation="Horizontal">
            <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}">
              <Rectangle.OpacityMask>
                <VisualBrush Stretch="Uniform" Visual="{StaticResource appbar_bug}"/>
              </Rectangle.OpacityMask>
            </Rectangle>
            <TextBlock Margin="5,0,5,0">Test</TextBlock>
          </StackPanel>
        </Button>
        <Button Command="{StaticResource About}" ToolTip="About">
          <StackPanel Orientation="Horizontal">
            <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}">
              <Rectangle.OpacityMask>
                <VisualBrush Stretch="Uniform" Visual="{StaticResource appbar_question}"/>
              </Rectangle.OpacityMask>
            </Rectangle>
            <TextBlock Margin="5,0,5,0">About</TextBlock>
          </StackPanel>
        </Button>
        <Button Command="{StaticResource OpenSettings}" ToolTip="Application Settings">
          <StackPanel Orientation="Horizontal">
            <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}">
              <Rectangle.OpacityMask>
                <VisualBrush Stretch="Uniform" Visual="{StaticResource appbar_settings}"/>
              </Rectangle.OpacityMask>
            </Rectangle>
            <TextBlock Margin="5,0,5,0">Settings</TextBlock>
          </StackPanel>
        </Button>
        <Button x:Name="BtnKeywordsEditMode" Command="{StaticResource KeywordsEditMode}" ToolTip="Edit Keywords">
          <StackPanel Orientation="Horizontal">
            <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}">
              <Rectangle.OpacityMask>
                <VisualBrush Stretch="Uniform" Visual="{StaticResource appbar_edit}"/>
              </Rectangle.OpacityMask>
            </Rectangle>
            <TextBlock Margin="5,0,5,0">Edit</TextBlock>
          </StackPanel>
        </Button>
        <Button x:Name="BtnKeywordsEditModeCancel" Command="{StaticResource KeywordsEditModeCancel}" ToolTip="Cancel edit Keywords">
          <StackPanel Orientation="Horizontal">
            <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}">
              <Rectangle.OpacityMask>
                <VisualBrush Stretch="Uniform" Visual="{StaticResource appbar_cancel}"/>
              </Rectangle.OpacityMask>
            </Rectangle>
            <TextBlock Margin="5,0,5,0">Cancel</TextBlock>
          </StackPanel>
        </Button>
        <Button x:Name="BtnKeywordsEditModeSave" Command="{StaticResource KeywordsEditModeSave}" ToolTip="Save Keywords">
          <StackPanel Orientation="Horizontal">
            <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}">
              <Rectangle.OpacityMask>
                <VisualBrush Stretch="Uniform" Visual="{StaticResource appbar_save}"/>
              </Rectangle.OpacityMask>
            </Rectangle>
            <TextBlock Margin="5,0,5,0">Save</TextBlock>
          </StackPanel>
        </Button>
      </ToolBar>
    </ToolBarTray>
    <StatusBar DockPanel.Dock="Bottom" x:Name="MainStatusBar">
      <StatusBar.ItemsPanel>
        <ItemsPanelTemplate>
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="100" />
            </Grid.ColumnDefinitions>
          </Grid>
        </ItemsPanelTemplate>
      </StatusBar.ItemsPanel>
      <StatusBarItem>
        <TextBlock Text="{Binding ViewBaseInfo}" />
      </StatusBarItem>
      <Separator Grid.Column="1" />
      <StatusBarItem Grid.Column="2">
        <TextBlock Text="{Binding CurrentPictureFilePath}" />
      </StatusBarItem>
      <Separator Grid.Column="3" />
      <StatusBarItem Grid.Column="4">
        <ProgressBar x:Name="StatusProgressBar" Width="90" Height="16" />
      </StatusBarItem>
    </StatusBar>
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="350" />
        <ColumnDefinition Width="3" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      
      <TabControl x:Name="TcMain" SelectionChanged="TcMain_OnSelectionChanged">
        
        <TabItem Header="Folders" HorizontalAlignment="Left">
          <!-- TreeView Folders -->
          <TreeView x:Name="TvFolders" >
            <TreeView.ItemContainerStyle>
              <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource MetroTreeViewItem}">
                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                <Setter Property="VerticalContentAlignment" Value="Stretch" />
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
              </Style>
            </TreeView.ItemContainerStyle>

            <TreeView.Resources>
              <!-- TreeView Folders - BaseItem (Category) -->
              <HierarchicalDataTemplate DataType="{x:Type data:BaseItem}" ItemsSource="{Binding Items}">
                <StackPanel Orientation="Horizontal" Background="Transparent" PreviewMouseRightButtonDown="AttachContextMenu" PreviewMouseUp="TreeViewFolders_Select">
                  <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=Foreground}">
                    <Rectangle.OpacityMask>
                      <VisualBrush Stretch="Uniform" Visual="{Binding IconName, Converter={StaticResource StaticResourceConverter}}"/>
                    </Rectangle.OpacityMask>
                  </Rectangle>
                  <TextBlock Text="{Binding Title}" VerticalAlignment="Center" Margin="5,0,0,0" />
                </StackPanel>
              </HierarchicalDataTemplate>

              <!-- TreeView Folders - Folder -->
              <HierarchicalDataTemplate DataType="{x:Type data:Folder}" ItemsSource="{Binding Items}">
                <StackPanel Orientation="Horizontal" Background="Transparent" AllowDrop="True"
                            PreviewMouseRightButtonDown="AttachContextMenu"
                            PreviewMouseUp="TreeViewFolders_Select" 
                            Drop="TvFolders_OnDrop" 
                            MouseMove="TvFolders_OnMouseMove" 
                            DragEnter="TvFolders_AllowDropCheck" 
                            DragLeave="TvFolders_AllowDropCheck"
                            DragOver="TvFolders_AllowDropCheck">
                  <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=Foreground}">
                    <Rectangle.OpacityMask>
                      <VisualBrush Stretch="Uniform" Visual="{Binding IconName, Converter={StaticResource StaticResourceConverter}}"/>
                    </Rectangle.OpacityMask>
                  </Rectangle>
                  <TextBlock Text="{Binding Title}" VerticalAlignment="Center" Margin="5,0,0,0" />
                  <TextBox VerticalAlignment="Center" Margin="5,0,0,0" Visibility="Collapsed" KeyDown="TvFoldersEdit_OnKeyDown" LostFocus="TreeViewCancelEdit_LostFocus" />
                </StackPanel>
              </HierarchicalDataTemplate>
            </TreeView.Resources>
          </TreeView>
        </TabItem>
        
        <TabItem Header="Keywords" x:Name="TabKeywords" HorizontalAlignment="Left">
          <!-- TreeView Keywords -->
          <TreeView x:Name="TvKeywords">
            <TreeView.ItemContainerStyle>
              <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource MetroTreeViewItem}">
                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                <Setter Property="VerticalContentAlignment" Value="Stretch" />
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                <Style.Triggers>
                  <DataTrigger Binding="{Binding IsMarked}" Value="True">
                    <Setter Property="Background" Value="{DynamicResource AccentColorBrush4}" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TreeView.ItemContainerStyle>
            
            
            <TreeView.Resources>
              <!-- TreeView Keywords - BaseItem (Category) -->
              <HierarchicalDataTemplate DataType="{x:Type data:BaseItem}" ItemsSource="{Binding Items}">
                <StackPanel Orientation="Horizontal" Background="Transparent" PreviewMouseRightButtonDown="AttachContextMenu" PreviewMouseUp="TreeViewKeywords_Select">
                  <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=Foreground}">
                    <Rectangle.OpacityMask>
                      <VisualBrush Stretch="Uniform" Visual="{Binding IconName, Converter={StaticResource StaticResourceConverter}}"/>
                    </Rectangle.OpacityMask>
                  </Rectangle>
                  <TextBlock Text="{Binding Title}" VerticalAlignment="Center" Margin="5,0,0,0" />
                </StackPanel>
              </HierarchicalDataTemplate>

              <!-- TreeView Keywords - Keyword -->
              <HierarchicalDataTemplate DataType="{x:Type data:Keyword}" ItemsSource="{Binding Items}">
                <StackPanel Orientation="Horizontal" Background="Transparent" PreviewMouseRightButtonDown="AttachContextMenu" PreviewMouseUp="TreeViewKeywords_Select">
                  <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=Foreground}">
                    <Rectangle.OpacityMask>
                      <VisualBrush Stretch="Uniform" Visual="{Binding IconName, Converter={StaticResource StaticResourceConverter}}"/>
                    </Rectangle.OpacityMask>
                  </Rectangle>
                  <TextBlock Text="{Binding Title}" VerticalAlignment="Center" Margin="5,0,0,0" />
                  <TextBox VerticalAlignment="Center" Margin="5,0,0,0" Visibility="Collapsed" KeyDown="TvKeywordsEdit_OnKeyDown" LostFocus="TreeViewCancelEdit_LostFocus" />
                  <TextBlock Text="{Binding PicCount}" VerticalAlignment="Center" Margin="5,0,0,0" Style="{StaticResource KeywordsPicCountStyle}" Background="{DynamicResource AccentColorBrush4}" Padding="5,0" />
                </StackPanel>
              </HierarchicalDataTemplate>
              
              <!-- TreeView Keywords - Person -->
              <HierarchicalDataTemplate DataType="{x:Type data:Person}">
                <StackPanel Orientation="Horizontal" Background="Transparent" PreviewMouseRightButtonDown="AttachContextMenu" PreviewMouseUp="TreeViewKeywords_Select">
                  <Rectangle Width="18" Height="18" VerticalAlignment="Center" Fill="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=Foreground}">
                    <Rectangle.OpacityMask>
                      <VisualBrush Stretch="Uniform" Visual="{Binding IconName, Converter={StaticResource StaticResourceConverter}}"/>
                    </Rectangle.OpacityMask>
                  </Rectangle>
                  <TextBlock Text="{Binding Title}" VerticalAlignment="Center" x:Name="TextBlockTitle" Margin="5,0,0,0" />
                  <TextBlock Text="{Binding PicCount}"  VerticalAlignment="Center" Margin="5,0,0,0" Style="{StaticResource KeywordsPicCountStyle}" Background="{DynamicResource AccentColorBrush4}" Padding="5,0" />
                </StackPanel>
              </HierarchicalDataTemplate>
            </TreeView.Resources>

          </TreeView>
        </TabItem>
        
        <TabItem Header="Filters" HorizontalAlignment="Left">
          <TreeView x:Name="TvFilters">
          </TreeView>
        </TabItem>
        
      </TabControl>
      
      <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="{StaticResource WhiteBrush}" />
      
      <WebBrowser x:Name="WbThumbs" Grid.Column="2" Margin="0,0,2,2" ></WebBrowser>
    </Grid>
  </DockPanel>
</controls:MetroWindow>
